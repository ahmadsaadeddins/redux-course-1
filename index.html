<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todos/Goals</title>
</head>

<body>
  <div>
    <h1>Todo List</h1>
    <input id="todo" type="text" placeholder="Add Todo" />
    <button id="todoBtn">Add Todo</button>
    <ul id="todos"></ul>
  </div>
  <div>
    <h1>Goals</h1>
    <input id="goal" type="text" placeholder="Add Goal" />
    <button id="goalBtn">Add Goal</button>
    <ul id="goals"></ul>
  </div>

  <script type="text/javascript">
    function generateId() {
      return (
        Math.random().toString(36).substring(2) +
        new Date().getTime().toString(36)
      );
    }
    // Library Code
    function createStore(reducer) {
      // The store should have four parts
      // 1. the state
      let state;

      // 2. Get the state
      const getState = () => state;

      // 3. Listen to changes on the state.
      let listeners = [];
      const subscribe = (listener) => {
        listeners.push(listener);

        // Unsubscribe it from listeners
        return () => {
          listeners = listeners.filter((l) => l !== listener);
        };
      };

      // 4. Update the state
      const dispatch = (action) => {
        state = reducer(state, action);

        // Invoke subscribed functions we are saved in listeners
        listeners.forEach((listener) => listener());
      };

      return {
        getState,
        subscribe,
        dispatch,
      };
    }

    // App code
    const ADD_TODO = "ADD_TODO";
    const REMOVE_TODO = "REMOVE_TODO";
    const TOGGLE_TODO = "TOGGLE_TODO";
    const ADD_GOAL = "ADD_GOAL";
    const REMOVE_GOAL = "REMOVE_GOAL";

    const addTodoAction = (todo) => ({ type: ADD_TODO, todo });
    const removeTodoAction = (id) => ({ type: REMOVE_TODO, id });
    const toggleTodoAction = (id) => ({ type: TOGGLE_TODO, id });
    const addGoalAction = (goal) => ({ type: ADD_GOAL, goal });
    const removeGoalAction = (id) => ({ type: REMOVE_GOAL, id });

    // Reducer
    function todos(state = [], action) {
      switch (action.type) {
        case ADD_TODO:
          return state.concat([action.todo]);
        case REMOVE_TODO:
          return state.filter((todo) => todo.id !== action.id);
        case TOGGLE_TODO:
          return state.map((todo) =>
            todo.id !== action.id
              ? todo
              : // : { name: todo.name, id: todo.id, complete: !todo.complete }
              Object.assign({}, todo, { complete: !todo.complete })
          );
        default:
          return state;
      }
    }

    function goals(state = [], action) {
      switch (action.type) {
        case ADD_GOAL:
          return state.concat([action.goal]);
        case REMOVE_GOAL:
          return state.filter((goal) => goal.id !== action.id);
        default:
          return state;
      }
    }

    function rootReducer(state = {}, action) {
      return {
        todos: todos(state.todos, action),
        goals: goals(state.goals, action),
      };
    }

    // Init store
    const store = createStore(rootReducer);
    const unsubscribe = store.subscribe(() =>
      console.log("the new state is: ", store.getState())
    );

    store.dispatch(
      addTodoAction({
        id: 0,
        name: "Learn Redux",
        complete: false,
      })
    );

    store.dispatch(
      addTodoAction({
        id: 1,
        name: "Learn React",
        complete: true,
      })
    );

    store.dispatch(
      addTodoAction({
        id: 2,
        name: "Learn JS",
        complete: true,
      })
    );

    store.dispatch(
      addGoalAction({
        id: 0,
        name: "Run a marthon",
      })
    );

    store.dispatch(
      addGoalAction({
        id: 1,
        name: "wash the car",
      })
    );

    // DOM Code

    const addTodoToDOM = () => {
      const input = document.getElementById("todo");
      name = input.value;
      input.value = "";

      store.dispatch(
        addTodoAction({ id: generateId(), name, complete: false })
      );
    };
    const addGoalToDOM = () => {
      const input = document.getElementById("goal");
      name = input.value;
      input.value = "";

      store.dispatch(addGoalAction({ id: generateId(), name }));
    };

    document
      .getElementById("todoBtn")
      .addEventListener("click", addTodoToDOM);

    document
      .getElementById("goalBtn")
      .addEventListener("click", addGoalToDOM);
  </script>
</body>

</html>